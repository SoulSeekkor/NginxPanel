@page "/"
@using System.Diagnostics;

@inject Shared.State.CLI _cli

<PageTitle>Index</PageTitle>

<pre style="font-style: italic;">@outputTest</pre>

@code {
    private string outputTest = string.Empty;

    protected override void OnInitialized()
    {
        _cli.OutReceived += new DataReceivedEventHandler(CLI_OutputDataReceived);
        _cli.ErrorReceived += new DataReceivedEventHandler(CLI_OutputDataReceived);
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            await _cli.RunCommandAsync("sudo apt update");
            await _cli.RunCommandAsync("whoami");
            await _cli.RunCommandAsync("nginx -v");
        }
    }

    private void CLI_OutputDataReceived(object sender, DataReceivedEventArgs e)
    {
        outputTest += "\r\n" + e.Data;
        InvokeAsync(() => StateHasChanged());
    }
}